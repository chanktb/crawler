<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
  <h1><a href="/crawler/">Danh sách tools</a></h1>
<title>Crawl sản phẩm v2 (og:title / og:image)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; }
  h2 { font-size: 20px; margin-bottom: 10px; }
  .instructions { font-size: 14px; color: #444; background: #f9f9f9; padding: 10px; border: 1px solid #ddd; margin-bottom: 20px; }
  input, button { padding: 8px; margin: 5px 0; width: 100%; }
  button { cursor: pointer; background: #28a745; color: white; border: none; }
  .product { margin-bottom: 30px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
  .product img { max-width: 700px; display: block; }
  .running { font-weight: bold; color: red; margin-top: 5px; display: none; }
</style>
</head>
<body>

<h2>crawl sản phẩm v2 (og:title / og:image)</h2>
<p>Sử dụng cho các site đã chặn REST API nhưng trên trang sản phẩm vẫn còn để link prev hoặc next dạng mũi tên</p>
<div class="instructions">
  <p><strong>Hướng dẫn sử dụng:</strong></p>
  <ol>
    <li>Truy cập <a href="https://www.scraperapi.com/" target="_blank">ScraperAPI</a> và đăng ký để lấy API key (miễn phí).</li>
    <li>Truy cập website cần crawl, mở sản phẩm mới nhất và copy URL của nó.</li>
    <li>Dán API key và URL sản phẩm vào bên dưới, sau đó bấm <strong>Bắt đầu</strong>.</li>
  </ol>
</div>

<label>Nhập API Key:</label>
<input type="text" id="apiKey" placeholder="Nhập API key" value="a81f3cb242118447359ed92553e82749">

<label>Nhập URL sản phẩm:</label>
<input type="text" id="startUrl" placeholder="Dán URL sản phẩm...">

<button id="startBtn">Bắt đầu</button>
<div class="running" id="runningStatus">Đang chạy...</div>

<div id="results"></div>

<script>
async function fetchProduct(url, apiKey, index) {
  const apiUrl = `https://api.scraperapi.com?api_key=${apiKey}&url=${encodeURIComponent(url)}`;
  const res = await fetch(apiUrl);
  const html = await res.text();
  const doc = new DOMParser().parseFromString(html, "text/html");

  const title = doc.querySelector('meta[property="og:title"]')?.content || "Không tìm thấy tiêu đề";
  const img = doc.querySelector('meta[property="og:image"]')?.content || "";

  // Thêm sản phẩm vào kết quả
  const container = document.getElementById("results");
  const productDiv = document.createElement("div");
  productDiv.className = "product";
  productDiv.innerHTML = `<div><strong>#${index}</strong></div>
                          <img src="${img}" alt="${title}">
                          <div>${title}</div>`;
  container.appendChild(productDiv);

  // Tìm URL tiếp theo
  let nextLink = doc.querySelector('.product-prev a')?.href;
  if (!nextLink) {
    nextLink = doc.querySelector('a[rel="next"]')?.href;
  }

  return nextLink;
}

document.getElementById("startBtn").addEventListener("click", async () => {
  const apiKey = document.getElementById("apiKey").value.trim();
  let url = document.getElementById("startUrl").value.trim();

  if (!apiKey || !url) {
    alert("Vui lòng nhập API key và URL sản phẩm!");
    return;
  }

  document.getElementById("results").innerHTML = "";
  document.getElementById("runningStatus").style.display = "block";

  let index = 1;
  while (url && index <= 100) {
    try {
      url = await fetchProduct(url, apiKey, index);
      index++;
    } catch (err) {
      console.error(err);
      break;
    }
  }

  document.getElementById("runningStatus").style.display = "none";
});
</script>

</body>
</html>





