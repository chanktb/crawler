<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Extractor TechTeesUSA V2 (Online via Proxy)</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h2 { color: #333; }
    input[type="text"] { width: 80%; padding: 8px; }
    button { padding: 8px 12px; margin-left: 5px; }
    .product { margin-bottom: 30px; padding: 10px; background: white; border-radius: 5px; }
    .product img { max-width: 700px; height: auto; display: block; margin-bottom: 10px; }
    .title { font-weight: bold; font-size: 18px; }
</style>
</head>
<body>

<h2>Extractor sản phẩm TechTeesUSA V2 (Online via Proxy)</h2>
<input type="text" id="urlInput" placeholder="Nhập URL, ví dụ: https://techteesusa.com/product-category/funny-t-shirt/">
<button id="fetchBtn">Quét sản phẩm</button>

<div id="output"></div>

<script>
document.getElementById('fetchBtn').addEventListener('click', function() {
    const url = document.getElementById('urlInput').value.trim();
    if (!url) {
        alert('Vui lòng nhập URL trang sản phẩm.');
        return;
    }

    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);

    fetch(proxyUrl)
        .then(response => {
            if (!response.ok) throw new Error('Không thể tải trang (CORS hoặc lỗi mạng).');
            return response.json();
        })
        .then(data => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(data.contents, 'text/html');

            const startDiv = doc.querySelector('div.row.large-columns-5.medium-columns-3.small-columns-2.row-normal');
            if (!startDiv) {
                alert('Không tìm thấy danh sách sản phẩm.');
                return;
            }

            const products = startDiv.querySelectorAll('.product-small.box');
            let outputHTML = '';
            let index = 1;

            products.forEach(prod => {
                const imgTag = prod.querySelector('img');
                const titleTag = prod.querySelector('p.name.product-title a');

                let imgSrc = imgTag ? imgTag.getAttribute('src') : '';

                // Nếu link ảnh không bắt đầu bằng http => đổi sang domain gốc
                if (imgSrc && !imgSrc.startsWith('http')) {
                    const fileName = imgSrc.split('/').pop();
                    imgSrc = 'https://images.techteesusa.com/2025/08/' + fileName;
                }

                const title = titleTag ? titleTag.textContent.trim() : 'Không có tiêu đề';

                outputHTML += `
                    <div class="product">
                        <div>#${index}</div>
                        ${imgSrc ? `<img src="${imgSrc}" alt="Product Image">` : ''}
                        <div class="title">${title}</div>
                    </div>
                `;
                index++;
            });

            document.getElementById('output').innerHTML = outputHTML;
        })
        .catch(err => {
            alert('Lỗi: ' + err.message);
            console.error(err);
        });
});
</script>

</body>
</html>
